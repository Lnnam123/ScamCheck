<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Account - ScamCheck</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Inter: chá»‰ dÃ¹ng tá»‘t cho brand -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;700;800;900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/account.css">
</head>

<body class="account-page page">

  <!-- NAVBAR PILL -->
  <div class="pill-nav-wrap">
    <div class="top-pill-nav">
      <button class="pill-item" onclick="goHome()">Home</button>
      <button class="pill-item" onclick="about()">About</button>
      <button class="pill-item" onclick="logout()">Log Out</button>
    </div>
  </div>

  <div class="container-sm account-wrap">
    <div class="card">
      <div class="card-title brand">ScamCheck</div>
      <div class="card-subtitle">ThÃ´ng tin tÃ i khoáº£n</div>

      <!-- INFO -->
      <div class="field">
        <label>Há» vÃ  tÃªn</label>
        <input class="input" id="fullname" placeholder="VD: Nguyá»…n VÄƒn A"
      <div class="field">
        <label>TÃªn tÃ i khoáº£n</label>
        <input class="input" id="username" disabled>
      </div>

      <div class="field">
        <label>Email</label>
        <input class="input" type="email" id="email" placeholder="example@gmail.com">
      </div>

      <div class="field">
        <label>Sá»‘ Ä‘iá»‡n thoáº¡i</label>
        <input class="input" type="text" id="phone" placeholder="VD: 0987654321">
      </div>

      <div class="field">
        <label>Quyá»n</label>
        <input class="input" id="role" disabled>
      </div>

      <button class="btn btn-primary btn-full" onclick="save()">ğŸ’¾ LÆ°u thay Ä‘á»•i</button>
      <p id="msg" class="center mt-12" style="font-weight:900;color:var(--success)"></p>

      <hr class="hr">

      <!-- CHANGE PASSWORD GO TO SEPARATE PAGE -->
      <button class="btn btn-outline btn-full" onclick="goChangePassword()">ğŸ”’ Äá»•i máº­t kháº©u</button>

      <div class="center mt-16">
        <a href="select.html">â† Quay láº¡i</a>
      </div>
    </div>
  </div>

<script>
  const user = JSON.parse(localStorage.getItem("user") || "null");
  const token = localStorage.getItem("token");

  if (!user || !token) {
    location.href = "login.html";
  }

  function goHome() { location.href = "select.html"; }
  function about() { alert("ScamCheck - cÃ´ng cá»¥ kiá»ƒm tra & bÃ¡o cÃ¡o lá»«a Ä‘áº£o."); }
  function logout() {
    localStorage.removeItem("user");
    localStorage.removeItem("token");
    location.href = "login.html";
  }

  function goChangePassword() {
    location.href = "change-password.html";
  }

  // Load account info
  fetch("/api/account", {
    headers: { "Authorization": "Bearer " + token }
  })
  .then(r => {
    if (r.status === 401) { logout(); return null; }
    return r.json();
  })
  .then(d => {
    if (!d) return;
    fullname.value = d.fullname || "";
    username.value = d.username || "";
    email.value = d.email || "";
    phone.value = d.phone || "";
    role.value = d.role || "";

    fullname.disabled = (d.role !== "admin"); // chá»‰ admin Ä‘Æ°á»£c sá»­a há» tÃªn
  })
  .catch(() => {
    msg.style.color = "var(--danger)";
    msg.innerText = "KhÃ´ng thá»ƒ táº£i thÃ´ng tin tÃ i khoáº£n";
  });

  // Save email + phone
  function save() {
    msg.style.color = "var(--muted)";
    msg.innerText = "Äang lÆ°u...";

    fetch("/api/account/update", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      },
    body: JSON.stringify({
      email: email.value,
      phone: phone.value,
      fullname: fullname.value
    })
  })
    .then(r => {
      if (r.status === 401) { logout(); return null; }
      return r.json();
    })
    .then(d => {
      if (!d) return;
      const ok = (d.message || "").toLowerCase().includes("thÃ nh cÃ´ng");
      msg.style.color = ok ? "var(--success)" : "var(--danger)";
      msg.innerText = d.message || "CÃ³ lá»—i xáº£y ra";
    })
    .catch(() => {
      msg.style.color = "var(--danger)";
      msg.innerText = "KhÃ´ng thá»ƒ káº¿t ná»‘i server";
    });
  }
</script>

</body>
</html>