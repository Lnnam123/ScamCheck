<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ƒê·ªïi m·∫≠t kh·∫©u - ScamCheck</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;700;800;900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/account.css">
</head>
<body class="account-page page">

  <div class="pill-nav-wrap">
    <div class="top-pill-nav">
      <button class="pill-item" onclick="goHome()">Home</button>
      <button class="pill-item" onclick="goAccount()">Account</button>
      <button class="pill-item" onclick="logout()">Log Out</button>
    </div>
  </div>

  <div class="container-sm account-wrap">
    <div class="card">
      <div class="card-title brand">ScamCheck</div>
      <div class="card-subtitle">ƒê·ªïi m·∫≠t kh·∫©u</div>

      <div class="field">
        <label>M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
        <input class="input" type="password" id="currentPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i">
      </div>

      <div class="field">
        <label>M·∫≠t kh·∫©u m·ªõi</label>
        <input class="input" type="password" id="newPassword" placeholder="T·ªëi thi·ªÉu 6 k√Ω t·ª±">
      </div>

      <div class="field">
        <label>Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi</label>
        <input class="input" type="password" id="confirmNewPassword" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi">
      </div>

      <button class="btn btn-primary btn-full" onclick="changePassword()">üîí ƒê·ªïi m·∫≠t kh·∫©u</button>
      <p id="pwMsg" class="center mt-12" style="font-weight:900;"></p>

      <div class="center mt-16">
        <a href="account.html">‚Üê Quay l·∫°i Account</a>
      </div>
    </div>
  </div>

<script>
  const token = localStorage.getItem("token");
  const user = JSON.parse(localStorage.getItem("user") || "null");
  if (!token || !user) location.href = "login.html";

  function goHome(){ location.href="select.html"; }
  function goAccount(){ location.href="account.html"; }
  function logout(){ localStorage.clear(); location.href="login.html"; }

  function changePassword(){
    pwMsg.innerText = "";
    if (newPassword.value.length < 6){
      pwMsg.style.color = "var(--danger)";
      pwMsg.innerText = "M·∫≠t kh·∫©u m·ªõi t·ªëi thi·ªÉu 6 k√Ω t·ª±";
      return;
    }
    if (newPassword.value !== confirmNewPassword.value){
      pwMsg.style.color = "var(--danger)";
      pwMsg.innerText = "M·∫≠t kh·∫©u m·ªõi kh√¥ng kh·ªõp";
      return;
    }

    fetch("/api/account/change-password", {
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "Authorization":"Bearer "+token
      },
      body: JSON.stringify({
        currentPassword: currentPassword.value,
        newPassword: newPassword.value
      })
    })
    .then(r=>r.json())
    .then(d=>{
      const ok = (d.message||"").toLowerCase().includes("th√†nh c√¥ng");
      pwMsg.style.color = ok ? "var(--success)" : "var(--danger)";
      pwMsg.innerText = d.message || "C√≥ l·ªói x·∫£y ra";
      if (ok){
        currentPassword.value="";
        newPassword.value="";
        confirmNewPassword.value="";
      }
    })
    .catch(()=>{
      pwMsg.style.color="var(--danger)";
      pwMsg.innerText="Kh√¥ng th·ªÉ k·∫øt n·ªëi server";
    });
  }
</script>

</body>
</html>
