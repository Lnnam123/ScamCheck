<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ScamCheck - Kiá»ƒm tra sá»‘ Ä‘iá»‡n thoáº¡i</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700;800;900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/check.css">
</head>

<body class="app-bg check-page">
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="brand-icon">ğŸ“±</div>
        <div>
          <div class="brand-name">Kiá»ƒm tra sá»‘ Ä‘iá»‡n thoáº¡i</div>
          <div class="brand-sub">Tra cá»©u & bÃ¡o cÃ¡o lá»«a Ä‘áº£o</div>
        </div>
      </div>

      <nav class="nav">
        <button class="nav-pill" onclick="goHome()">Home</button>
        <button class="nav-pill" onclick="about()">Giá»›i thiá»‡u</button>
        <button class="nav-pill danger" onclick="logout()">ÄÄƒng xuáº¥t</button>
      </nav>
    </div>
  </header>

  <main class="shell">
    <section class="panel">
      <div class="card">
        <div class="card-head">
          <div>
            <div class="card-title">Tra cá»©u nhanh</div>
            <div class="card-sub">Nháº­p sá»‘ Ä‘iá»‡n thoáº¡i Ä‘á»ƒ kiá»ƒm tra dá»¯ liá»‡u cáº£nh bÃ¡o</div>
          </div>
          <div class="badge">Protected</div>
        </div>

        <div class="field">
          <label>Sá»‘ Ä‘iá»‡n thoáº¡i</label>
          <input class="input" id="phone" placeholder="VD: 0987654321" inputmode="tel" />
          <div class="helper" id="phoneErr"></div>
        </div>

        <div class="actions">
          <button class="btnx btnx-primary" onclick="checkPhone()">ğŸ” Kiá»ƒm tra</button>
          <button class="btnx btnx-ghost" onclick="fillExample()">DÃ¡n vÃ­ dá»¥</button>
        </div>

        <div id="checkResult" class="result-box"></div>

        <hr class="hr">

        <div class="card-title" style="font-size:16px;margin-bottom:8px;">BÃ¡o cÃ¡o (náº¿u cÃ³)</div>

        <div class="field">
          <label>MÃ´ táº£ hÃ nh vi lá»«a Ä‘áº£o</label>
          <textarea class="textarea" id="desc" rows="3" placeholder="MÃ´ táº£ ngáº¯n: ká»‹ch báº£n, sá»‘ tÃ i khoáº£n nháº­n tiá»n, ná»™i dung chat..."></textarea>
        </div>

        <button class="btnx btnx-outline" onclick="reportPhone()">ğŸš¨ BÃ¡o cÃ¡o lá»«a Ä‘áº£o</button>
        <p id="reportMsg" class="note"></p>
      </div>

      <aside class="side">
        <div class="side-card">
          <div class="side-title">Gá»£i Ã½</div>
          <ul class="side-list">
            <li>Nháº­p Ä‘Ãºng Ä‘á»‹nh dáº¡ng sá»‘ (khÃ´ng khoáº£ng tráº¯ng).</li>
            <li>Náº¿u cÃ³ dáº¥u hiá»‡u lá»«a Ä‘áº£o, hÃ£y bÃ¡o cÃ¡o kÃ¨m mÃ´ táº£.</li>
            <li>Káº¿t quáº£ â€œCáº£nh bÃ¡oâ€ thÆ°á»ng cÃ³ rá»§i ro cao.</li>
          </ul>
        </div>

        <div class="side-card">
          <div class="side-title">Chuyá»ƒn nhanh</div>
          <a class="quick" href="check-link.html">ğŸ”— Kiá»ƒm tra Ä‘Æ°á»ng link</a>
          <a class="quick" href="select.html">ğŸ  Vá» trang chÃ­nh</a>
        </div>
      </aside>
    </section>
  </main>

<script>
  const user = JSON.parse(localStorage.getItem("user"));
  const token = localStorage.getItem("token");
  if (!user || !token) location.href = "login.html";

  const phoneEl = document.getElementById("phone");
  const phoneErr = document.getElementById("phoneErr");
  const checkResult = document.getElementById("checkResult");
  const desc = document.getElementById("desc");
  const reportMsg = document.getElementById("reportMsg");

  function goHome(){ location.href="select.html"; }
  function about(){ alert("ScamCheck - cÃ´ng cá»¥ kiá»ƒm tra & bÃ¡o cÃ¡o lá»«a Ä‘áº£o."); }
  function logout(){ localStorage.clear(); location.href="login.html"; }

  function fillExample(){ phoneEl.value = "0987654321"; phoneEl.focus(); }

  function setResult(type, text){
    checkResult.className = "result-box show " + type;
    checkResult.textContent = text;
  }

  function validatePhone(v){
    const s = String(v || "").trim();
    // Ä‘Æ¡n giáº£n: 9-12 sá»‘
    return /^[0-9]{9,12}$/.test(s);
  }

  function checkPhone(){
    const v = phoneEl.value.trim();
    phoneErr.textContent = "";
    checkResult.className = "result-box";

    if (!validatePhone(v)){
      phoneErr.textContent = "Sá»‘ Ä‘iá»‡n thoáº¡i khÃ´ng há»£p lá»‡ (chá»‰ gá»“m 9â€“12 chá»¯ sá»‘).";
      phoneEl.focus();
      return;
    }

    checkResult.className = "result-box show";
    checkResult.innerHTML = `<span class="spinner"></span>Äang kiá»ƒm tra...`;

    fetch("/api/check", {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ type:"phone", value: v })
    })
    .then(r=>r.json())
    .then(d=>{
      const text = d.result || "KhÃ´ng cÃ³ dá»¯ liá»‡u.";
      const isScam = text.includes("Lá»ªA Äáº¢O") || text.includes("Cáº¢NH BÃO");
      setResult(isScam ? "danger" : "safe", text);
    })
    .catch(()=>{
      setResult("danger", "âŒ Lá»—i káº¿t ná»‘i server");
    });
  }

  function reportPhone(){
    const v = phoneEl.value.trim();
    phoneErr.textContent = "";

    if (!validatePhone(v)){
      phoneErr.textContent = "Vui lÃ²ng nháº­p sá»‘ Ä‘iá»‡n thoáº¡i há»£p lá»‡ trÆ°á»›c khi bÃ¡o cÃ¡o.";
      phoneEl.focus();
      return;
    }
    if (!desc.value.trim()){
      reportMsg.textContent = "âš ï¸ HÃ£y nháº­p mÃ´ táº£ trÆ°á»›c khi gá»­i bÃ¡o cÃ¡o.";
      return;
    }

    reportMsg.textContent = "Äang gá»­i bÃ¡o cÃ¡o...";
    fetch("/api/report", {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ type:"phone", value: v, description: desc.value })
    })
    .then(r=>r.json())
    .then(d=>{
      reportMsg.textContent = d.message || "ÄÃ£ gá»­i.";
      desc.value = "";
    })
    .catch(()=> reportMsg.textContent = "âŒ Lá»—i káº¿t ná»‘i server");
  }
</script>

</body>
</html>
